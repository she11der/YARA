import "hash"

rule R3C0NST_ATM_Malware_Atmspitter : FILE
{
	meta:
		description = "Detects ATM Malware ATMSpitter"
		author = "Frank Boldewin (@r3c0nst)"
		id = "4497f304-6f04-5f5d-91ba-9124e5262078"
		date = "2016-07-20"
		modified = "2019-03-29"
		reference = "https://topics.amcham.com.tw/2017/02/looking-back-at-the-first-banks-atm-heist/"
		source_url = "https://github.com/fboldewin/YARA-rules//blob/54e9e6899b258b72074b2b4db6909257683240c2/ATM.Malware.ATMSpitter.yar#L3-L21"
		license_url = "N/A"
		hash = "658b0502b53f718bd0611a638dfd5969"
		logic_hash = "684820ed29c50a41bd262862cb97c70c0cbb8554e7e4be300986519423249c50"
		score = 75
		quality = 65
		tags = "FILE"

	strings:
		$Code_Bytes = { B9 E0 07 00 00 66 ?? ?? ?? ?? 0F 85 DD 02 00 00 66 ?? ?? ?? ?? ?? 0F 85 D1 02 00 00 }
		$Service = "Congratulations! You are very skilled in reverse engineering!" nocase ascii

	condition:
		(hash.sha256(0, filesize )=="4035d977202b44666885f9781ac8755c799350a03838ff782eb730c0d7069958") or ($Code_Bytes and $Service)
}
