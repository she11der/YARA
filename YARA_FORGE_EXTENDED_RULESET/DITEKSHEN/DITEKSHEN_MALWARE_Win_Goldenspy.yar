import "pe"

rule DITEKSHEN_MALWARE_Win_Goldenspy : FILE
{
	meta:
		description = "GoldenSpy dropper payload"
		author = "SpiderLabs Trustwave"
		id = "01d3f14a-fefb-5cea-b055-d7e9f4c7d13b"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://trustwave.azureedge.net/media/16908/the-golden-tax-department-and-emergence-of-goldenspy-malware.pdf"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L1302-L1314"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "908047db2167733da0089375dbfd636881e721cc219da110755b81581d438cfa"
		score = 75
		quality = 67
		tags = "FILE"

	strings:
		$reg = "Software\\IDG\\DA" nocase wide ascii
		$str1 = "requestStr" nocase wide ascii
		$str2 = "nb_app_log_mutex" nocase wide ascii
		$str3 = { 510F4345[0-10]50518D8DCCFE[0-20]837D1C[0-20]8D45[0-15]0F4345[0-20]505157 }

	condition:
		( uint16(0)==0x5A4D) and $reg and 2 of ($str*)
}
