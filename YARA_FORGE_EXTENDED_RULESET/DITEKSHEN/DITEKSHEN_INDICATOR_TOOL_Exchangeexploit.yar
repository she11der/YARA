import "pe"

rule DITEKSHEN_INDICATOR_TOOL_Exchangeexploit : FILE
{
	meta:
		description = "Hunt for executables potentially embedding Exchange Server exploitation artificats"
		author = "ditekSHen"
		id = "429f738a-009a-5326-92e0-bdc907be96f2"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/indicator_tools.yar#L785-L798"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "4b0d22a296cab6591d63568aa44845ef7fcc413d45c368a712928411d11a8177"
		score = 75
		quality = 69
		tags = "FILE"

	strings:
		$s1 = "ecp/default.flt?" ascii wide nocase
		$s2 = "owa/auth/logon.aspx?" ascii wide nocase
		$s3 = "X-AnonResource-Backend" ascii wide
		$s4 = "EWS/Exchange.asmx?" ascii wide nocase
		$s5 = "X-BEResource" ascii wide
		$s6 = "https://%s/owa/auth/" ascii wide

	condition:
		( uint16(0)==0x5a4d or uint16(0)==0x457f) and 5 of them
}
