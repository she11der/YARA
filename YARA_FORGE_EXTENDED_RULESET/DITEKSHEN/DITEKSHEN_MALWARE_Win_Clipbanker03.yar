import "pe"

rule DITEKSHEN_MALWARE_Win_Clipbanker03 : FILE
{
	meta:
		description = "Detects ClipBanker"
		author = "ditekSHen"
		id = "57ba7d33-eba4-5bc1-9893-5441e439b900"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L9900-L9920"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "29bbb833c9aecc18b398b8c0d80649994f4992277d1aa2ee4ae8e319b59125d5"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "UNIC_KEY" fullword wide
		$s2 = "[StartUp]" fullword wide
		$s3 = "[Kill]" fullword wide
		$s4 = "[antivm]" fullword wide
		$s5 = "AntiVM" fullword ascii
		$s6 = "AntiKill" fullword ascii
		$s7 = "hWndRemove" fullword ascii
		$s8 = "/Clip(watch|Chang|Mon)/" fullword ascii
		$w1 = "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0" fullword wide
		$w2 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0" fullword wide
		$w3 = "/create /sc MINUTE /mo 1 /tn \"Windows Service\" /tr \"" fullword wide
		$w4 = "Software\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon" fullword wide
		$w5 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" fullword wide

	condition:
		uint16(0)==0x5a4d and (5 of ($s*) or all of ($w*) or 6 of them )
}
