import "pe"

rule DITEKSHEN_MALWARE_Win_Darkcomet : FILE
{
	meta:
		description = "Detects DarkComet"
		author = "ditekSHen"
		id = "ae2412df-adae-5640-9404-7b093c5095b4"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L7790-L7810"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "444df3c914c47500018614af10036864b459e7873daf079b684352dbe52f0486"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "%s, ClassID: %s" ascii
		$s2 = "%s, ProgID: \"%s\"" ascii
		$s3 = "#KCMDDC51#" ascii
		$s4 = "#BOT#VisitUrl" ascii
		$s5 = "#BOT#OpenUrl" ascii
		$s6 = "#BOT#Ping" ascii
		$s7 = "#BOT#RunPrompt" ascii
		$s8 = "#BOT#CloseServer" ascii
		$s9 = "#BOT#SvrUninstall" ascii
		$s10 = "#BOT#URLUpdate" ascii
		$s11 = "#BOT#URLDownload" ascii
		$s12 = /BTRESULT(Close|Download|HTTP|Mass|Open|Ping\|Respond|Run|Syn|UDP|Uninstall\|uninstall|Update|Visit)/ ascii
		$s13 = "dclogs\\" fullword ascii

	condition:
		uint16(0)==0x5a4d and 4 of them
}
