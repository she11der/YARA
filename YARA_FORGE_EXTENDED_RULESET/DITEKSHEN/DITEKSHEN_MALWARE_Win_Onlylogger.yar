import "pe"

rule DITEKSHEN_MALWARE_Win_Onlylogger : FILE
{
	meta:
		description = "Detects OnlyLogger loader variants"
		author = "ditekSHen"
		id = "525aa2a0-5090-5f96-999b-67ca4379f897"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L8861-L8880"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "1b39a4d2a6d3a2633cfa98adc1dfe99d10d2493fd06c9f875c56ec7689b7a561"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = { 45 6c 65 76 61 74 65 64 00 00 00 00 4e 4f 54 20 65 6c 65 76 61 74 65 64 }
		$s2 = "\" /f & erase \"" ascii
		$s3 = "/c taskkill /im \"" ascii
		$s4 = "KILLME" fullword ascii
		$s5 = "C:\\Windows\\System32\\cmd.exe" fullword ascii
		$gn = ".php?pub=" ascii
		$ip = /\/1[a-z0-9A-Z]{4,5}/ fullword ascii
		$h1 = "Accept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1" fullword ascii
		$h2 = "Accept-Language: ru-RU,ru;q=0.9,en;q=0.8" fullword ascii
		$h3 = "Accept-Charset: iso-8859-1, utf-8, utf-16, *;q=0.1" fullword ascii
		$h4 = "Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0" fullword ascii
		$h5 = "Content-Type: application/x-www-form-urlencoded" fullword wide

	condition:
		uint16(0)==0x5a4d and ( all of ($s*) or (#ip>5 and ($gn or 3 of ($s*) or all of ($h*))) or ( all of ($h*) and 3 of ($s*)))
}
