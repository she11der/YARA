import "pe"

rule DITEKSHEN_MALWARE_Win_Infinitylock : FILE
{
	meta:
		description = "Detects InfinityLock ransomware"
		author = "ditekSHen"
		id = "7a66cc19-c635-580b-abc2-b58bd48673bd"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L5705-L5723"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "634759f1c2d48becebc9c87e146e898524071738f74b7001b112dc793bcb581c"
		score = 75
		quality = 73
		tags = "FILE"

	strings:
		$s1 = "_Encrypted$" fullword ascii
		$s2 = "PublicKeyToken=" fullword ascii nocase
		$s3 = "GenerateHWID" fullword ascii
		$s4 = "CreateKey" fullword ascii
		$d1 = "ProgrammFiles" fullword ascii
		$d2 = "OneDrive" fullword ascii
		$d3 = "ProgrammsX86" fullword ascii
		$d4 = "UserDirs" fullword ascii
		$d5 = "B_Drive" fullword ascii
		$pdb1 = "F:\\DESKTOP!\\ChkDsk\\ChkDsk\\obj\\" ascii
		$pdb2 = "\\ChkDsk\\obj\\Debug\\PremiereCrack.pdb" ascii

	condition:
		uint16(0)==0x5a4d and (( all of ($s*) and 1 of ($d*)) or (4 of ($d*) and 2 of ($s*)) or ( any of ($pdb*) and 1 of ($s*) and 1 of ($d*)))
}
