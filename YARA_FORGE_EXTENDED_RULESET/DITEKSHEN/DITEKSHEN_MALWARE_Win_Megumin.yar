import "pe"

rule DITEKSHEN_MALWARE_Win_Megumin : FILE
{
	meta:
		description = "Megumin payload"
		author = "ditekSHen"
		id = "bb1743f7-0bd8-5c0a-ad78-c4747904204f"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L1085-L1108"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "fb4934814c45d2465b6e1589c3b489116343ca0c17ebb916b5c9247fc676c74d"
		score = 75
		quality = 50
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Trojan.Megumin"

	strings:
		$s1 = "loadpe|" fullword ascii
		$s2 = "Megumin/2.0" fullword ascii
		$s3 = "/c start /I \"\" \"" fullword ascii
		$s4 = "jsbypass|" fullword ascii
		$cnc1 = "Mozilla/5.0 (Windows NT 6.1) Megumin/2.0" fullword ascii
		$cnc2 = "/cdn-cgi/l/chk_jschl?s=" fullword ascii
		$cnc3 = "/newclip?hwid=" fullword ascii
		$cnc4 = "/isClipper" fullword ascii
		$cnc5 = "/task?hwid=" fullword ascii
		$cnc6 = "/completed?hwid=" fullword ascii
		$cnc7 = "/gate?hwid=" fullword ascii
		$cnc8 = "/addbot?hwid=" fullword ascii
		$pdb = "\\MeguminV2\\Release\\MeguminV2.pdb" ascii

	condition:
		( uint16(0)==0x5a4d and ( all of ($s*) or 5 of ($cnc*) or $pdb)) or 11 of them
}
