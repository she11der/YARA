import "pe"

rule DITEKSHEN_MALWARE_Win_UNK04 : FILE
{
	meta:
		description = "Detects unknown malware (proxy tool)"
		author = "ditekSHen"
		id = "6a178f37-a9fd-5a83-a550-c6333342ac9b"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L5282-L5296"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "ba6e5bbc1d094b23e3870af963503d1ccbcd56adc24126b4a38b77d4b88b4b67"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$x1 = "127.0.0.1/%d" fullword ascii
		$x2 = "SYSTEM\\CurrentControlSet\\SERVICES\\PORTPROXY\\V4TOV4\\TCP" fullword ascii
		$x3 = "%s rundll32.exe" fullword ascii
		$s1 = "kxetray.exe" fullword ascii
		$s2 = "ksafe.exe" fullword ascii
		$s3 = "Mcshield.exe" fullword ascii
		$s4 = "Miner.exe" fullword ascii

	condition:
		uint16(0)==0x5a4d and all of ($x*) and 2 of ($s*)
}
