import "pe"

rule DITEKSHEN_MALWARE_Win_Boxcaon : FILE
{
	meta:
		description = "Detects IndigoZebra BoxCaon"
		author = "ditekSHen"
		id = "becbde73-8b72-5e98-8684-87068ffff71b"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L6729-L6746"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "4f2f26e6678d49bfa5937511b1788a059ee10e1b5f19e53d6386199738a925a5"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "<RetCMD null>" fullword wide
		$s2 = "<txt null>" fullword wide
		$s3 = "C:\\Users\\Public\\%d\\" fullword wide
		$s4 = "api.dropboxapi.com" fullword wide
		$s5 = "/2/files/upload" fullword wide
		$ts1 = "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" ascii wide
		$ts2 = "%s /A /C \"%s\" > %s" ascii wide
		$ts3 = "ersInfo" ascii wide
		$ts4 = "%svmpid%d.log" ascii wide
		$ts5 = "%scscode%d.log" ascii wide

	condition:
		( uint16(0)==0x5a4d and all of ($s*)) or all of ($ts*)
}
