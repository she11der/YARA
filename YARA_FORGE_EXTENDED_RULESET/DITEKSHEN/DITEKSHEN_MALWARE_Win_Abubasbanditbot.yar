import "pe"

rule DITEKSHEN_MALWARE_Win_Abubasbanditbot : FILE
{
	meta:
		description = "Detects Abubasbandit Bot. Observed to drop cryptocurrency miner detected by MALWARE_Win_CoinMiner02"
		author = "ditekSHen"
		id = "8bedd1f7-bd77-5f26-8665-1d23fe56100f"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L10540-L10557"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "aae40178dadff720b42d211a025fd696eabdcc91761c6a91809f5f088c588c31"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$x1 = "magickeycmd" ascii
		$x2 = "chat_id" ascii
		$x3 = "GetTempPathW" ascii
		$x4 = "Add-MpPreference" ascii
		$x5 = "-Command" ascii
		$s1 = "application/x-www-form-urlencoded" ascii
		$s2 = "gzip, deflate/index.html" ascii
		$s3 = "powershellAdd-MpPreference -ExclusionPath" ascii
		$s4 = "tar-xf-C" ascii
		$s5 = "temp_file.bin" ascii

	condition:
		uint16(0)==0x5a4d and ( all of ($x*) or (4 of ($x*) and 2 of ($s*)) or (( all of ($s*) and 3 of ($x*))) or (8 of them ))
}
