import "pe"

rule DITEKSHEN_MALWARE_Win_Gdriverat : FILE
{
	meta:
		description = "Detects GDriveRAT"
		author = "ditekSHen"
		id = "29e46280-39d1-5d49-ab0d-0a32398b30f0"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L3265-L3284"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "134e66d0afc90e7fbab2c9dd034f85eb504903481e12c1ab8d7bab9321da817a"
		score = 75
		quality = 50
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Trojan.GDriveRAT"

	strings:
		$h1 = "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart" fullword wide
		$h2 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36" fullword wide
		$h3 = "multipart/related; boundary=\"boundary_tag\"" fullword wide
		$h4 = "https://www.googleapis.com/drive/v3/files" fullword wide
		$s1 = "move gdrive.exe \"C:\\Users\\" fullword wide
		$s2 = "file_data" fullword ascii
		$s3 = "comp_id" fullword ascii
		$s4 = "file_name" fullword ascii
		$s5 = "refresh_token" fullword ascii
		$s6 = "commands" fullword ascii
		$s7 = "execute" fullword ascii

	condition:
		uint16(0)==0x5a4d and 3 of ($h*) and 5 of ($s*)
}
