import "pe"

rule DITEKSHEN_MALWARE_Win_Disco_Nightclub : FILE
{
	meta:
		description = "Hunts for Disco NightClub"
		author = "ditekSHen"
		id = "79cbd351-e5d9-5f1f-8e73-71e0acca2707"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L11235-L11253"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "ee0bd110ea1a3182284c4b3d6dd7eff48ca809a35a925147c716b18a88c0a233"
		score = 75
		quality = 51
		tags = "FILE"

	strings:
		$s1 = "\\OfficeBroker\\OfficeBroker.exe" ascii wide nocase
		$s2 = "\\EDGEUPDATE\\EDGEAOUT" ascii wide nocase
		$s3 = "\\EDGEUPDATE\\update" ascii wide nocase
		$s4 = "windows.system.update.com" ascii wide nocase
		$s5 = "edgeupdate-security-windows.com" ascii wide nocase
		$s6 = "nightclub::" ascii wide nocase
		$s7 = "EncryptedPasswordFlt" ascii wide nocase
		$s8 = "Microsoft\\def\\Gfr45.cfg" ascii wide nocase
		$s9 = "::keylog::" ascii wide nocase
		$pdb1 = "\\AbcdMainProject\\Rootsrc\\Projects\\MainS\\Ink\\" ascii wide nocase
		$pdb2 = "\\Autogen\\Kh\\AutogenAlg\\" ascii wide nocase

	condition:
		uint16(0)==0x5a4d and ((1 of ($pdb*) and 2 of ($s*)) or (4 of ($s*)))
}
