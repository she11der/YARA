import "pe"

rule DITEKSHEN_MALWARE_Win_Egregor : FILE
{
	meta:
		description = "Detects Egregor ransomware variants"
		author = "ditekSHen"
		id = "2e24d4ec-39c2-5148-80a1-04f96bc8b477"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L2397-L2434"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "d39a7bf89a7574f7dfe56db78c8cdbbee97782f829805d4ee87fd9f1635154cd"
		score = 75
		quality = 75
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Ransomware.Egregor"

	strings:
		$s1 = "C:\\Logmein\\{888-8888-9999}\\Logmein.log" fullword wide
		$p1 = "--deinstall" fullword wide
		$p2 = "--del" fullword wide
		$p3 = "--exit" fullword wide
		$p4 = "--kill" fullword wide
		$p5 = "--loud" fullword wide
		$p6 = "--nooperation" fullword wide
		$p7 = "--nop" fullword wide
		$p8 = "--skip" fullword wide
		$p9 = "--useless" fullword wide
		$p10 = "--yourmommy" fullword wide
		$p11 = "-passegregor" ascii wide
		$p12 = "-peguard" ascii wide
		$p13 = "--nomimikatz" ascii wide
		$p14 = "--multiproc" ascii wide
		$p15 = "--killrdp" ascii wide
		$p16 = "--nonet" ascii wide
		$p17 = "--norename" ascii wide
		$p18 = "--greetings" ascii wide

	condition:
		( uint16(0)==0x5a4d and pe.is_dll() and (( all of ($s*) and 1 of ($p*)) or (2 of them and filesize <1000KB and for any i in (0..pe.number_of_sections) : ((pe.sections[i].name==".00cfg"))))) or 8 of ($p*)
}
