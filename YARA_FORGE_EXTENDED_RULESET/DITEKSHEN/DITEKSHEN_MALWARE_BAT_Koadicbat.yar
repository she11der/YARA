import "pe"

rule DITEKSHEN_MALWARE_BAT_Koadicbat : FILE
{
	meta:
		description = "Koadic post-exploitation framework BAT payload"
		author = "ditekSHen"
		id = "dad7bb32-b1f1-5c6d-89b2-77cc49b5f020"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/yara/malware.yar#L1176-L1186"
		license_url = "https://github.com/ditekshen/detection/blob/5fc671f9f4a5847c929d488dc74f8b671529b254/LICENSE.txt"
		logic_hash = "1ee6c0189a5111c61af1dbe571524427bff95a7e3907f97ce51d272a8f701cf5"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$v1_1 = "&@cls&@set" ascii
		$v2_1 = { 26 63 6c 73 0d 0a 40 25 }
		$m1 = /:~\d+,1%+/ ascii

	condition:
		uint16(0)==0xfeff and ((1 of ($v1*) or 1 of ($v2*)) and #m1>100)
}
