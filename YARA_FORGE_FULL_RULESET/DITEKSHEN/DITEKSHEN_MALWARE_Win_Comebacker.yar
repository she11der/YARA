import "pe"

rule DITEKSHEN_MALWARE_Win_Comebacker : FILE
{
	meta:
		description = "Detects ComeBacker variants. Associated with ZINC / Lazarus"
		author = "ditekSHen"
		id = "d0454d09-4a15-5251-aa7a-cb00604715ca"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L4477-L4492"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "0d806fd199f0e8e3576ca837781c2fa06f1a09d75ea16602effb72754d8e4940"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "ENGINE_get_RAND" ascii
		$s2 = "./{IES" fullword ascii
		$s3 = "TODO: <Company name>" fullword wide
		$s4 = "@Microsoft Corperation. All rights reserved." fullword wide
		$s5 = "Microsoft@Windows@Operating System" fullword wide
		$x1 = "C:\\Windows\\System32\\rundll32.exe %s,%s %s %s" fullword ascii wide
		$x2 = "ASN2_TYPE_new" fullword ascii wide
		$x3 = "SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\" fullword ascii wide

	condition:
		uint16(0)==0x5a4d and ( all of ($s*) or all of ($x*))
}
