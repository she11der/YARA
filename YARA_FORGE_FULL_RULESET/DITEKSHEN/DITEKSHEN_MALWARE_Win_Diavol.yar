import "pe"

rule DITEKSHEN_MALWARE_Win_Diavol : FILE
{
	meta:
		description = "Detects Diavol ransomware"
		author = "ditekSHen"
		id = "df5cea04-505e-5009-b247-ba71b6d81ecc"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L6759-L6784"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "bcc7a9dc2dcb12ded75af9d79ab0f46f0e69da9e9fe72539be6351306ed11c18"
		score = 75
		quality = 48
		tags = "FILE"

	strings:
		$s1 = "README_FOR_DECRYPT.txt" ascii wide nocase
		$s2 = ".lock64" fullword ascii wide
		$s3 = "LockMainDIB" ascii wide
		$s4 = "locker.divided" ascii wide
		$s5 = "%tob_dic%/" wide
		$s6 = "%cid_bot%" wide
		$m1 = "GENBOTID" ascii wide
		$m2 = "SHAPELISTS" ascii wide
		$m3 = "REGISTER" ascii wide
		$m4 = "FROMNET" ascii wide
		$m5 = "SERVPROC" ascii wide
		$m6 = "SMBFAST" ascii wide
		$c1 = "/Bnyar8RsK04ug/" fullword ascii
		$c2 = "/landing" fullword ascii
		$c3 = "/wipe" fullword ascii
		$c4 = "&ip_local1=111.111.111.111&ip_local2=222.222.222.222&ip_external=2.16.7.12" fullword ascii
		$c5 = "&group=" fullword ascii
		$c6 = "/BnpOnspQwtjCA/register" fullword ascii

	condition:
		uint16(0)==0x5a4d and (4 of ($s*) or 5 of ($m*) or 4 of ($c*) or 7 of them )
}
