import "pe"

rule DITEKSHEN_MALWARE_Win_Guidlma : FILE
{
	meta:
		description = "Detects Guildma"
		author = "ditekSHen"
		id = "135ddc6a-5001-54c0-a66c-3e0e5fe6319f"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L3988-L4006"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "11a0d9c67139627b6820c928840d816ed22b48452ce0b2f856c86c183cdfc8ab"
		score = 75
		quality = 25
		tags = "FILE"

	strings:
		$v1_1 = "marxvxinhhm98.dll" fullword wide
		$v1_2 = "marxvxinhhmxa.gif" fullword wide
		$v1_3 = "marxvxinhhmxb.gif" fullword wide
		$v1_4 = "c:\\programdata" fullword wide
		$v1_5 = "\\tempa\\" fullword wide
		$v2_1 = "C:\\Windows\\System32\\dllhost.exe" fullword ascii
		$v2_2 = "C:\\Windows\\SysWOW64\\dllhost.exe" fullword ascii
		$v2_3 = "C:\\Users\\Public\\go" fullword ascii
		$v2_4 = ":%:*:/:>:C:H:W:\\:a:p:u:z:" fullword ascii
		$v2_5 = ": :%:*:9:>:C:R:W:\\:k:p:u:" fullword ascii
		$v2_6 = ":*:/:4:C:H:M:\\:a:f:u:z:" fullword ascii

	condition:
		uint16(0)==0x5a4d and 3 of ($v1*) or 5 of ($v2*)
}
