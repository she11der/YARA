import "pe"

rule DITEKSHEN_MALWARE_JS_Koadicjs
{
	meta:
		description = "Koadic post-exploitation framework JS payload"
		author = "ditekSHen"
		id = "8598d5cb-0486-52b0-a686-6bd014f35c44"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L1188-L1208"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "689116f74996fecf4c16c224e8cd842ad5b5e989de2dfdf0debeb9a26d8a12fa"
		score = 75
		quality = 75
		tags = ""

	strings:
		$s1 = "window.moveTo(-" ascii
		$s2 = "window.onerror = function(sMsg, sUrl, sLine) { return false; }" fullword ascii
		$s3 = "window.onfocus = function() { window.blur(); }" fullword ascii
		$s4 = "window.resizeTo(" ascii
		$s5 = "window.blur();" fullword ascii
		$hf1 = "<hta:application caption=\"no\" windowState=\"minimize\" showInTaskBar=\"no\"" fullword ascii
		$hf2 = "<hta:application caption=\"no\" showInTaskBar=\"no\" windowState=\"minimize\" navigable=\"no\" scroll=\"no\""
		$ht1 = "<hta:application" ascii
		$ht2 = "caption=\"no\"" ascii
		$ht3 = "showInTaskBar=\"no\"" ascii
		$ht4 = "windowState=\"minimize\"" ascii
		$ht5 = "navigable=\"no\"" ascii
		$ht6 = "scroll=\"no\"" ascii

	condition:
		all of ($s*) and (1 of ($hf*) or all of ($ht*))
}
