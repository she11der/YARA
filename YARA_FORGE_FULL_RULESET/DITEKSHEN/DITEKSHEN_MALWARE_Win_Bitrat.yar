import "pe"

rule DITEKSHEN_MALWARE_Win_Bitrat : FILE
{
	meta:
		description = "Detects BitRAT RAT"
		author = "ditekSHen"
		id = "9041a21f-0f27-5e90-8429-863e361381bf"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L2125-L2153"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "128c3c8cea0439f272de241c77fc9ed46e64419e497091e444e98123dad059cb"
		score = 75
		quality = 25
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Trojan.BitRAT"

	strings:
		$s1 = "\\plg\\" fullword ascii
		$s2 = "klgoff_del" fullword ascii
		$s3 = "files_delete" ascii
		$s4 = "files_zip_start" fullword ascii
		$s5 = "files_exec" fullword ascii
		$s6 = "drives_get" fullword ascii
		$s7 = "srv_list" fullword ascii
		$s8 = "con_list" fullword ascii
		$s9 = "ddos_stop" fullword ascii
		$s10 = "socks5_srv_start" fullword ascii
		$s11 = "/getUpdates?offset=" fullword ascii
		$s12 = "Action: /dlex" fullword ascii
		$s13 = "Action: /clsbrw" fullword ascii
		$s14 = "Action: /usb" fullword ascii
		$s15 = "/klg" fullword ascii
		$s16 = "klg|" fullword ascii
		$s17 = "Slowloris" fullword ascii
		$s18 = "Bot ID:" ascii
		$t1 = "<sz>N/A</sz>" fullword ascii
		$t2 = "<silent>N/A</silent>" fullword ascii

	condition:
		uint16(0)==0x5a4d and (7 of ($s*) or (4 of ($s*) and 1 of ($t*)))
}
