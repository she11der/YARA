import "pe"

rule DITEKSHEN_MALWARE_Win_PWSH_Poshcookiestealer
{
	meta:
		description = "Detects PowerShell PoshCookieStealer"
		author = "ditekSHen"
		id = "7326a056-288b-534b-811d-172bd6936d7b"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L9082-L9096"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "234958098d09732675dd539e8d25c6754ba50bf92b3a19e7fef8c68d70503ec4"
		score = 75
		quality = 75
		tags = ""

	strings:
		$s1 = "\\User Data\\default\\Network\\Cookies" ascii nocase
		$s2 = "Send-ToEmail" ascii
		$s3 = "[Security.Cryptography.ProtectedData]::Unprotect($" ascii
		$s4 = "$($env:LOCALAPPDATA)\\" ascii
		$s5 = "$($env:HOMEPATH)\\" ascii
		$s6 = "|ForEach-Object ToString X2) -join ''" ascii
		$s7 = ".Attachments.Add($" ascii

	condition:
		5 of them
}
