import "pe"

rule DITEKSHEN_MALWARE_Win_Teslarevenge : FILE
{
	meta:
		description = "Detects TeslaRevenge ransomware"
		author = "ditekSHen"
		id = "13e5bb15-47eb-5e49-a1a5-3d51cacede2f"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L9163-L9183"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "0f68eae8a076d00c8d058ec148d3557f5770dc827d4690b931faf98797426dbc"
		score = 75
		quality = 65
		tags = "FILE"

	strings:
		$s1 = "autospreadifnoav=" ascii wide
		$s2 = "autospread=" ascii wide
		$s3 = "noencryptext=" ascii wide
		$s4 = "teslarvng" wide
		$s5 = "finished encrypting" wide nocase
		$s6 = "net scan" wide nocase
		$s7 = "for /f %%x in ('wevtutil el') do wevtutil cl" ascii
		$s8 = "tasklist | find /i \"SDELETE.exe\"" ascii
		$e1 = "mshta.exe" ascii wide nocase
		$e2 = "sc.exe" ascii wide nocase
		$e3 = "vssadmin.exe" ascii wide nocase
		$e4 = "wbadmin.exe" ascii wide nocase
		$e5 = "cmd.exe" ascii wide nocase

	condition:
		uint16(0)==0x5a4d and (4 of ($s*) or ( all of ($e*) and 2 of ($s*)))
}
