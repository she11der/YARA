import "pe"

rule DITEKSHEN_MALWARE_Win_Flagpro : FILE
{
	meta:
		description = "Detects Flagpro"
		author = "ditekSHen"
		id = "da1bf899-feb5-5ed0-956e-c20bc3565a6e"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L9048-L9065"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "c5e5944426b7be690ad62dd0d98a8fc6f8135cab0dbdd8a5aaf1670491eda59d"
		score = 75
		quality = 25
		tags = "FILE"

	strings:
		$s1 = "download...." fullword ascii
		$s2 = "~MYTEMP" fullword wide
		$s3 = ".?AVCV20_LoaderApp@@" fullword ascii
		$s4 = ".?AVCV20_LoaderDlg@@" fullword ascii
		$s5 = "ExecYes" fullword ascii
		$s6 = /<BODY ID=CV\d+_LoaderDlg BGCOLOR=/ ascii
		$n1 = "://139.162.87.180" wide
		$n2 = "://172.104.109.217" wide
		$n3 = "://org.misecure.com/index.html" wide
		$b1 = /(get all|click|close|maybe|get_outerHTML|download\d) (finished|pass|ok|windows|failed)!/ fullword ascii

	condition:
		uint16(0)==0x5a4d and 4 of ($s*) or (1 of ($n*) and (2 of ($s*) or 1 of ($b*))) or (2 of ($s*) and 1 of ($b*))
}
