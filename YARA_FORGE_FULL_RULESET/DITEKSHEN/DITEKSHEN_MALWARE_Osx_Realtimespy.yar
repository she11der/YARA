import "pe"

rule DITEKSHEN_MALWARE_Osx_Realtimespy : FILE
{
	meta:
		description = "Detects macOS RealtimeSpy monitoring app"
		author = "ditekSHen"
		id = "6485abf3-896c-54cd-ad84-7bd86456e47b"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L3141-L3166"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "4ef2e1b8d34962cd3eab23f401b764b38b8332233aa2ae91b218af499d8ab8ff"
		score = 75
		quality = 57
		tags = "FILE"
		clamav_sig = "MALWARE.Osx.Trojan.RealtimeSpy"

	strings:
		$x1 = "SPYAGENT4HASHCIPHER" fullword ascii
		$x2 = ":username:password:acctid:compUser:compName:" ascii
		$x3 = ":username:password:acctid:compName:" ascii
		$x4 = "://www.realtime-spy-mac.com/" ascii
		$x5 = "/Users/spytech/" ascii
		$x6 = "shell script \"touch /private/var/db/.AccessibilityAPIEnabled\" password \"pwd\" with administrator privileges" ascii
		$x7 = "Content-Disposition: form-data; name=\"raptor_" ascii
		$c1 = "_OBJC_CLASS_$_LocationLogger" fullword ascii
		$c2 = "_OBJC_CLASS_$_MonitoringFunctions" fullword ascii
		$c3 = "_OBJC_CLASS_$_ProcessLogger" fullword ascii
		$c4 = "_OBJC_CLASS_$_RealtimeLoggingFunctions" fullword ascii
		$c5 = "_OBJC_CLASS_$_Realtime_SpyAppDelegate" fullword ascii
		$c6 = "_OBJC_CLASS_$_ScreenshotLogger" fullword ascii
		$c7 = "_OBJC_CLASS_$_Uploader" fullword ascii
		$c8 = "_OBJC_CLASS_$_UsageLogger" fullword ascii
		$c9 = "_OBJC_CLASS_$_WebsiteLogger" fullword ascii

	condition:
		uint16(0)==0xfacf and (2 of ($x*) or 2 of ($c*))
}
