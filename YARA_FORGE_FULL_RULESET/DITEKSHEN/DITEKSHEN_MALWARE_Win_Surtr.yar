import "pe"

rule DITEKSHEN_MALWARE_Win_Surtr : FILE
{
	meta:
		description = "Detects Surtr ransomware. Ransom note is similar to LockFile"
		author = "ditekSHen"
		id = "7a31415d-5c03-5537-9adb-65e637f9fa0e"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L9372-L9394"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "a8db5588079d471d8904f0444973973a0c01dbec1ccbe3d43a34d41a0dde495d"
		score = 75
		quality = 25
		tags = "FILE"

	strings:
		$s1 = "<title>SurtrRansomware</title>" ascii
		$s2 = "<HTA:APPLICATION ID=\"SurtrRansomware\"" ascii
		$s3 = "APPLICATIONNAME=\"SurtrRansomware\"" ascii
		$s4 = "src=\"data:image/jpeg; base64,/9j/4AAQSkZJRgABAQEAYABgAAD/2wCEAAgICAgJCAkKCgkNDgwODRMREBARExwUFhQWFBwrGx8bGx8bKyYuJSMlLiZENS8v" ascii
		$s5 = "4rbgxisigb4pxnloxzc265rmzaj7fslrhyouegtrph2a7xhh55r6xaid.onion" ascii
		$s6 = "schtasks /CREATE /SC ONLOGON /TN svchos" wide
		$s7 = "reg add HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\ /v \"svchos" ascii
		$s8 = "reg add HKEY_CURRENT_USER\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\ /v \"svchos" ascii
		$s9 = "SURTR_README.txt" wide
		$s10 = "surtr-decrypt.top" ascii
		$s11 = /(Public|Private|ID)_DATA\.surt/ wide

	condition:
		uint16(0)==0x5a4d and 4 of them
}
