import "pe"

rule DITEKSHEN_MALWARE_PWSH_CUMII
{
	meta:
		description = "Detects multi-dropper PowerShell"
		author = "ditekSHen"
		id = "07b77251-1d79-5521-8c05-ecfc662f45cb"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L11086-L11102"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "ab9e59b0552718928d170a988d129b38352700076847f2f409976016858864eb"
		score = 75
		quality = 75
		tags = ""
		clamav = "ditekSHen.MALWARE.PWSH.CUMII"

	strings:
		$s1 = ".('{1}{$}'.replace('$','0')" ascii nocase
		$s2 = ",'I').replace('!','ex')" ascii nocase
		$s3 = "'.replace('*','0001')" ascii nocase
		$s4 = "Remove-Item $" ascii nocase
		$s5 = "the File will start cumiing" ascii nocase
		$b1 = "011001100111010101101110011*" ascii
		$b2 = "0101001000*1110110*010011111" ascii
		$b3 = "01001101010110101001*11*0000" ascii

	condition:
		(3 of ($s*) and 1 of ($b*))
}
