import "pe"

rule DITEKSHEN_MALWARE_Win_Simda : FILE
{
	meta:
		description = "Detects Simda / Shifu infostealer"
		author = "ditekShen"
		id = "892a5ffe-ea1a-5df3-9c36-0198fa61b8b6"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L11361-L11377"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "3f06e86033e8f9534f9904a2a63c4717a9532eb235f6f4405ef1db7d9b93f036"
		score = 75
		quality = 25
		tags = "FILE"

	strings:
		$s1 = "command=auth_loginByPassword&back_command=&back_custom1=&" fullword ascii
		$s2 = "iexplore.exe|opera.exe|java.exe|javaw.exe|explorer.exe|isclient.exe|intpro.exe|ipc_full.exe|mnp.exe|cbsmain.dll|firefox.exe|clma" ascii
		$s3 = "debug_%s_%s.log" fullword ascii
		$s4 = "Content-Disposition: form-data; name=\"file\"; filename=\"report\"" ascii
		$s5 = "name=%s&port=%u" ascii
		$s6 = "id=%s&ver=4.0.1&up=%u&os=%03u&rights=%s&ltime=%s%d&token=%d" ascii
		$s7 = "{BotVer:" fullword ascii
		$s8 = "software\\microsoft\\windows nt\\currentversion\\winlogon" ascii
		$s9 = /(!|&|data_)inject(=ok)?/ fullword ascii

	condition:
		uint16(0)==0x5a4d and 6 of them
}
