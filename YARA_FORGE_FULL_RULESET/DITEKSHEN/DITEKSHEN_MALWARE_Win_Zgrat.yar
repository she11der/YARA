import "pe"

rule DITEKSHEN_MALWARE_Win_Zgrat : FILE
{
	meta:
		description = "Detects zgRAT"
		author = "ditekSHen"
		id = "ba35a97d-ec51-555a-ac75-7438ac00c2c5"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L7473-L7502"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "d8012af4923bf8cfd605e5e25547b07bdb0676aee732c49acf323d0e45a3d9e6"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "file:///" fullword wide
		$s2 = "{11111-22222-10009-11112}" fullword wide
		$s3 = "{11111-22222-50001-00000}" fullword wide
		$s4 = "get_Module" fullword ascii
		$s5 = "Reverse" fullword ascii
		$s6 = "BlockCopy" fullword ascii
		$s7 = "ReadByte" fullword ascii
		$s8 = { 4c 00 6f 00 63 00 61 00 74 00 69 00 6f 00 6e 00
                00 0b 46 00 69 00 6e 00 64 00 20 00 00 13 52 00
                65 00 73 00 6f 00 75 00 72 00 63 00 65 00 41 00
                00 11 56 00 69 00 72 00 74 00 75 00 61 00 6c 00
                20 00 00 0b 41 00 6c 00 6c 00 6f 00 63 00 00 0d
                57 00 72 00 69 00 74 00 65 00 20 00 00 11 50 00
                72 00 6f 00 63 00 65 00 73 00 73 00 20 00 00 0d
                4d 00 65 00 6d 00 6f 00 72 00 79 00 00 0f 50 00
                72 00 6f 00 74 00 65 00 63 00 74 00 00 0b 4f 00
                70 00 65 00 6e 00 20 00 00 0f 50 00 72 00 6f 00
                63 00 65 00 73 00 73 00 00 0d 43 00 6c 00 6f 00
                73 00 65 00 20 00 00 0d 48 00 61 00 6e 00 64 00
                6c 00 65 00 00 0f 6b 00 65 00 72 00 6e 00 65 00
                6c 00 20 00 00 0d 33 00 32 00 2e 00 64 00 6c 00
                6c }

	condition:
		uint16(0)==0x5a4d and all of them
}
