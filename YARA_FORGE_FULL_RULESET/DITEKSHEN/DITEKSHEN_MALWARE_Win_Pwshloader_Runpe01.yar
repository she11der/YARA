import "pe"

rule DITEKSHEN_MALWARE_Win_Pwshloader_Runpe01
{
	meta:
		description = "Detects PowerShell PE loader / executer. Observed Gorgon TTPs"
		author = "ditekSHen"
		id = "fd44f48c-7a24-512b-8375-c9f978a8b5bd"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L4907-L4920"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "7dd377f6a1cc48ef8ab9d53989755fb967c89d3798b721781bc09043ba3d86f4"
		score = 75
		quality = 75
		tags = ""

	strings:
		$rp1 = "GetType('RunPe.RunPe'" ascii
		$rp2 = "GetType(\"RunPe.RunPe\"" ascii
		$rm1 = "GetMethod('Run'" ascii
		$rm2 = "GetMethod(\"Run\"" ascii
		$s1 = ".Invoke(" ascii
		$s2 = "[Reflection.Assembly]::Load(" ascii

	condition:
		all of ($s*) and 1 of ($rp*) and 1 of ($rm*)
}
