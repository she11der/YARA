import "pe"

rule DITEKSHEN_MALWARE_Win_Raccoon : FILE
{
	meta:
		description = "Raccoon stealer payload"
		author = "ditekSHen"
		id = "5ebef663-623c-592e-b69a-f620492f0cc1"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L587-L606"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "258481982d20d229506f442a5a205fdc05f6ac4399f3a0665860e6529c30943b"
		score = 75
		quality = 50
		tags = "FILE"

	strings:
		$s1 = "inetcomm server passwords" fullword wide
		$s2 = "content-disposition: form-data; name=\"file\"; filename=\"data.zip\"" fullword ascii
		$s3 = ".?AVfilesystem_error@v1@filesystem@experimental@std@@" fullword ascii
		$s4 = "CredEnumerateW" fullword ascii
		$s5 = "%[^:]://%[^/]%[^" fullword ascii
		$s6 = "%99[^:]://%99[^/]%99[^" fullword ascii
		$s7 = "Login Data" wide
		$s8 = "m_it.object_iterator != m_object->m_value.object->end()" fullword wide
		$x1 = "endptr == token_buffer.data() + token_buffer.size()" fullword wide
		$x2 = "\\json.hpp" wide
		$x3 = "Microsoft_WinInet_" fullword wide
		$x4 = "Microsoft_WinInet_*" fullword wide

	condition:
		uint16(0)==0x5a4d and ((3 of ($x*) and 2 of ($s*)) or (4 of ($s*) and 1 of ($x*)))
}
