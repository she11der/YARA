import "pe"

rule DITEKSHEN_MALWARE_Win_Ircbot : FILE
{
	meta:
		description = "IRCBot payload"
		author = "ditekSHen"
		id = "69739d82-9760-5c4e-bf9e-60c60617a12a"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L1567-L1596"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "1ea640202cfbd0c3425a192c45938f632dc644f41c7974118e7491b026122818"
		score = 75
		quality = 67
		tags = "FILE"

	strings:
		$s1 = ".okuninstall" fullword wide
		$s2 = ".oksnapshot" fullword wide
		$s3 = "\\uspread.vbs" fullword wide
		$s4 = "KEYLogger" ascii nocase
		$s5 = "GetKeyLogs" fullword ascii
		$s6 = "GetLoocationInfo" fullword ascii
		$s7 = "CaputerScreenshot" fullword ascii
		$s8 = "get_SCRIPT_DATA" fullword ascii
		$s9 = /irc_(server|nickname|password|channle)/ fullword ascii
		$s10 = "machine_screenshot" fullword ascii
		$s11 = "CollectPassword" fullword ascii
		$s12 = "USBInfection" fullword ascii nocase
		$cnc1 = "&command=UpdateAndGetTasks&machine_id=" wide
		$cnc2 = "&machine_os=1&privateip=" wide
		$cnc3 = "&command=InsertTaskExecution&excuter_id=" wide
		$cnc4 = "&command=RegisterNewMachine" wide
		$cnc5 = "&command=UpdateNewMachine" wide
		$cnc6 = "&command=GetPayloads&keys=" wide
		$cnc7 = "&command=SaveSnapshot" wide
		$pdb = "\\Projects\\USBStarter\\USBStarter\\obj\\Release\\USBStarter.pdb" ascii

	condition:
		uint16(0)==0x5a4d and (7 of ($s*) or 3 of ($cnc*) or ($pdb and 2 of them ))
}
