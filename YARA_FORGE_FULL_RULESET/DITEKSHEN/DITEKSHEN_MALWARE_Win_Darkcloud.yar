import "pe"

rule DITEKSHEN_MALWARE_Win_Darkcloud : FILE
{
	meta:
		description = "Detects DarkCloud infostealer"
		author = "ditekSHen"
		id = "e29e1dc7-87b8-5d6b-b73b-460dc2530875"
		date = "2024-01-23"
		modified = "2024-01-23"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/yara/malware.yar#L10366-L10387"
		license_url = "https://github.com/ditekshen/detection/blob/c37b067259715d4c93ac274a0830c54b355556a1/LICENSE.txt"
		logic_hash = "7826cc4185d6edb760d062019e0fa30f800c34e5fb4b0eedcfb17081e6c7643d"
		score = 75
		quality = 48
		tags = "FILE"

	strings:
		$x1 = "=DARKCLOUD=" wide
		$x2 = "#DARKCLOUD#" wide
		$x3 = "DARKCLOUD" wide
		$s1 = "DC-Creds" fullword wide
		$s2 = "shell.application" fullword wide
		$s3 = "VBSQLite3.dll" ascii wide nocase
		$s4 = "getbinaryvalue" fullword wide
		$s5 = "sqlite_exec" fullword ascii
		$i1 = "RegWrite" fullword wide
		$i2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide
		$i3 = "\\Templates\\Stub\\Project" wide
		$i4 = "\\Credentials" wide
		$i5 = "SELECT " wide
		$i6 = "\\163MailContacts.txt" fullword wide

	condition:
		uint16(0)==0x5a4d and ((1 of ($x*) and (3 of ($s*) or 3 of ($i*))) or ( all of ($s*) and 1 of ($i*)) or (4 of ($s*) and 4 of ($i*)))
}
