rule SIGNATURE_BASE_SUSP_Jdniexploit_Indicators_Dec21 : FILE
{
	meta:
		description = "Detects indicators of JDNI usage in log files and other payloads"
		author = "Florian Roth (Nextron Systems)"
		id = "2df8b8f3-8d8d-5982-8c85-692b7d91ebb2"
		date = "2021-12-10"
		modified = "2021-12-12"
		reference = "https://github.com/flypig5211/JNDIExploit"
		source_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/yara/expl_log4j_cve_2021_44228.yar#L167-L180"
		license_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/LICENSE"
		logic_hash = "7886a67672001f0db72575d96d3a12341bfcdc49a9951e3d5e2a88ab46bf5a5d"
		score = 70
		quality = 35
		tags = "FILE"

	strings:
		$xr1 = /(ldap|ldaps|rmi|dns|iiop|http|nis|nds|corba):\/\/[a-zA-Z0-9\.]{7,80}:[0-9]{2,5}\/(Basic\/Command\/Base64|Basic\/ReverseShell|Basic\/TomcatMemshell|Basic\/JBossMemshell|Basic\/WebsphereMemshell|Basic\/SpringMemshell|Basic\/Command|Deserialization\/CommonsCollectionsK|Deserialization\/CommonsBeanutils|Deserialization\/Jre8u20\/TomcatMemshell|Deserialization\/CVE_2020_2555\/WeblogicMemshell|TomcatBypass|GroovyBypass|WebsphereBypass)\//

	condition:
		filesize <100MB and $xr1
}
