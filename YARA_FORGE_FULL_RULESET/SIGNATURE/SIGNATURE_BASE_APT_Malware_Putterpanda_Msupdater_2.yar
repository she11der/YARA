rule SIGNATURE_BASE_APT_Malware_Putterpanda_Msupdater_2 : FILE
{
	meta:
		description = "Detects Malware related to PutterPanda - MSUpdater"
		author = "Florian Roth (Nextron Systems)"
		id = "e9188a14-5c0c-551c-bdca-9f770f42935a"
		date = "2015-06-03"
		modified = "2023-12-05"
		reference = "VT Analysis"
		source_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/yara/apt_putterpanda.yar#L202-L236"
		license_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/LICENSE"
		hash = "365b5537e3495f8ecfabe2597399b1f1226879b1"
		logic_hash = "47d75e589d47a39d5a9c9e0047a143074d3d74b5541adf8cb3be968da732a96d"
		score = 70
		quality = 83
		tags = "FILE"
		license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"

	strings:
		$s0 = "winsta0\\default" fullword ascii
		$s1 = "EXPLORER.EXE" fullword ascii
		$s2 = "WNetEnumResourceA" fullword ascii
		$s3 = "explorer.exe" fullword ascii
		$s4 = "CreateProcessAsUserA" fullword ascii
		$s5 = "HttpSendRequestExA" fullword ascii
		$s6 = "HttpEndRequestA" fullword ascii
		$s7 = "GetModuleBaseNameA" fullword ascii
		$s8 = "GetModuleFileNameExA" fullword ascii
		$s9 = "HttpSendRequestA" fullword ascii
		$s10 = "HttpOpenRequestA" fullword ascii
		$s11 = "InternetConnectA" fullword ascii
		$s12 = "Process32Next" fullword ascii
		$s13 = "Process32First" fullword ascii
		$s14 = "CreatePipe" fullword ascii
		$s15 = "EnumProcesses" fullword ascii
		$s16 = "LookupPrivilegeValueA" fullword ascii
		$s17 = "PeekNamedPipe" fullword ascii
		$s18 = "EnumProcessModules" fullword ascii
		$s19 = "PSAPI.DLL" fullword ascii
		$s20 = "SPSSSQ" fullword ascii

	condition:
		uint16(0)==0x5a4d and filesize <220KB and all of them
}
