rule SIGNATURE_BASE_Opcloudhopper_Malware_5 : FILE
{
	meta:
		description = "Detects malware from Operation Cloud Hopper"
		author = "Florian Roth (Nextron Systems)"
		id = "1ad189f8-a4c2-5f56-beec-a55bd516ad8d"
		date = "2017-04-03"
		modified = "2023-12-05"
		reference = "https://www.pwc.co.uk/issues/cyber-security-data-privacy/insights/operation-cloud-hopper.html"
		source_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/yara/apt_op_cloudhopper.yar#L114-L134"
		license_url = "https://github.com/Neo23x0/signature-base/blob/c04cde449bdf5fb40bb001fb663d32a70f89abe4/LICENSE"
		logic_hash = "9b91ac8f450843c7c85e8d056218aff671bb0f345d16a7ba3f4180ac008bf318"
		score = 75
		quality = 85
		tags = "FILE"
		license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
		hash1 = "beb1bc03bb0fba7b0624f8b2330226f8a7da6344afd68c5bc526f9d43838ef01"

	strings:
		$x1 = "CWINDOWSSYSTEMROOT" fullword ascii
		$x2 = "YJ_D_KROPOX_M_NUJI_OLY_S_JU_MOOK" fullword ascii
		$x3 = "NJK_JK_SED_PNJHGFUUGIOO_PIY" fullword ascii
		$x4 = "c_VDGQBUl}YSB_C_VDlqSDYFU" fullword ascii
		$s7 = "FALLINLOVE" fullword ascii
		$op1 = { 83 ec 60 8d 4c 24 00 e8 6f ff ff ff 8d 4c 24 00 }

	condition:
		( uint16(0)==0x5a4d and filesize <100KB and (1 of ($x*) or 2 of them )) or (4 of them )
}
