rule SECUINFRA_MALWARE_Plugx_USB_Delivery_Ini_Recbin_Jun23
{
	meta:
		description = "Detects PlugX-style Malware delivery via removable Drives (USB) - Desktop.ini Recycle Bin; could potentially yield FPs"
		author = "SECUINFRA Falcon Team (@SI_FalconTeam)"
		id = "026eba63-12c1-55aa-b736-aea0494c1ab9"
		date = "2023-06-21"
		modified = "2023-06-21"
		reference = "https://unit42.paloaltonetworks.com/plugx-variants-in-usbs/"
		source_url = "https://github.com/SIFalcon/Detection/blob/2d7c66d7d16c7541bf2a9a83a7a6d334364a26fd/Yara/Malware/MALWARE_PlugX_USB_Delivery_Jun21.yar#L51-L70"
		license_url = "N/A"
		logic_hash = "af5a1f20e46d9db3a9b50b5d8845e60f058c2885a560756266afbd8f3a01bf1e"
		score = 75
		quality = 70
		tags = ""
		tlp = "CLEAR"

	strings:
		$s_shellclassinfo = "[.ShellClassInfo]" ascii
		$s_IconRes = "CLSID = {645FF040-5081-101B-9F08-00AA002F954E}" ascii
		$neg_LRN = "shell32.dll,-8964" ascii

	condition:
		all of ($s_*) and not $neg_LRN
}