rule SECUINFRA_MALWARE_Plugx_USB_Delivery_LNK_Jun23
{
	meta:
		description = "Detects PlugX-style Malware delivery via removable Drives (USB) - LNK File"
		author = "SECUINFRA Falcon Team (@SI_FalconTeam)"
		id = "14c2e37e-91d7-5b66-916f-a1544a69a6fc"
		date = "2023-06-21"
		modified = "2023-06-21"
		reference = "https://unit42.paloaltonetworks.com/plugx-variants-in-usbs/"
		source_url = "https://github.com/SIFalcon/Detection/blob/2d7c66d7d16c7541bf2a9a83a7a6d334364a26fd/Yara/Malware/MALWARE_PlugX_USB_Delivery_Jun21.yar#L1-L31"
		license_url = "N/A"
		logic_hash = "afbbaf44e97b6db584780e0739bffd9c70e05e86284cb25b25a9d02cbeffff1f"
		score = 75
		quality = 70
		tags = ""
		tlp = "CLEAR"

	strings:
		$lnk_magic = {4C 00 00 00 01 14 02 00}
		$driveletter_4X = {4? 00 3A 00 5C 00 A0 00 5C}
		$driveletter_5X = {5? 00 3A 00 5C 00 A0 00 5C}
		$s_cmd = "C:\\Windows\\System32\\cmd.exe" ascii
		$s_recBin = "\\RECYCLER.BIN\\" wide
		$s_shell32 = "%SystemRoot%\\system32\\SHELL32.dll" wide
		$s_comspec = "%ComSpec%" ascii

	condition:
		$lnk_magic at 0x0 and any of ($s_*) and ($driveletter_4X or $driveletter_5X)
}