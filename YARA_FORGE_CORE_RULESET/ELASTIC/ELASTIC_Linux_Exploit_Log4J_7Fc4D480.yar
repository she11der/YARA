rule ELASTIC_Linux_Exploit_Log4J_7Fc4D480 : FILE MEMORY
{
	meta:
		description = "Detects Linux Exploit Log4J (Linux.Exploit.Log4j)"
		author = "Elastic Security"
		id = "7fc4d480-5354-4b0b-93ee-2937ddd1565c"
		date = "2021-12-13"
		modified = "2022-01-26"
		reference = "https://github.com/elastic/protections-artifacts/"
		source_url = "https://github.com/elastic/protections-artifacts//blob/8b6b3b3977b462ae1c68ae8756c095b6bcba2da6/yara/rules/Linux_Exploit_Log4j.yar#L1-L24"
		license_url = "https://github.com/elastic/protections-artifacts//blob/8b6b3b3977b462ae1c68ae8756c095b6bcba2da6/LICENSE.txt"
		logic_hash = "b09d8dd9c422e7eb8aa23f8b1204d31fd290252925099300d6d19d73e562ca5e"
		score = 75
		quality = 75
		tags = "FILE, MEMORY"
		fingerprint = "cd06db6f5bebf0412d056017259b5451184d5ba5b2976efd18fa8f96dba6a159"
		severity = 100
		arch_context = "x86"
		scan_context = "file, memory"
		license = "Elastic License v2"
		os = "linux"

	strings:
		$jndi1 = "jndi.ldap.LdapCtx.c_lookup"
		$jndi2 = "logging.log4j.core.lookup.JndiLookup.lookup"
		$jndi3 = "com.sun.jndi.url.ldap.ldapURLContext.lookup"
		$exp1 = "Basic/Command/Base64/"
		$exp2 = "java.lang.ClassCastException: Exploit"
		$exp3 = "WEB-INF/classes/Exploit"
		$exp4 = "Exploit.java"

	condition:
		2 of ($jndi*) and 1 of ($exp*)
}
