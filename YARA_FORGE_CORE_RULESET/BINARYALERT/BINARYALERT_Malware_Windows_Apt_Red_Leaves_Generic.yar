rule BINARYALERT_Malware_Windows_Apt_Red_Leaves_Generic
{
	meta:
		description = "Red Leaves malware, related to APT10"
		author = "David Cannings"
		id = "e0067b05-eb4a-52ec-8f35-9336a631f03b"
		date = "2017-09-12"
		modified = "2017-09-12"
		reference = "https://github.com/nccgroup/Cyber-Defence/blob/master/Technical%20Notes/Red%20Leaves/Source/Red%20Leaves%20technical%20note%20v1.0.md"
		source_url = "https://github.com/airbnb/binaryalert//blob/a9c0f06affc35e1f8e45bb77f835b92350c68a0b/rules/public/malware/windows/malware_windows_apt_red_leaves_generic.yara#L1-L27"
		license_url = "https://github.com/airbnb/binaryalert//blob/a9c0f06affc35e1f8e45bb77f835b92350c68a0b/LICENSE"
		hash = "81df89d6fa0b26cadd4e50ef5350f341"
		logic_hash = "be03bba9d01e6584b5849514656fd7de866c478f343c0bc618d7dbeda1771696"
		score = 75
		quality = 80
		tags = ""

	strings:
		$a1 = "Feb 04 2015"
		$a2 = "I can not start %s"
		$a3 = "dwConnectPort" fullword
		$a4 = "dwRemoteLanPort" fullword
		$a5 = "strRemoteLanAddress" fullword
		$a6 = "strLocalConnectIp" fullword
		$a7 = "\\\\.\\pipe\\NamePipe_MoreWindows" wide
		$a8 = "RedLeavesCMDSimulatorMutex" wide
		$a9 = "(NT %d.%d Build %d)" wide
		$a10 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E)" wide
		$a11 = "red_autumnal_leaves_dllmain.dll" wide ascii
		$a12 = "__data" wide
		$a13 = "__serial" wide
		$a14 = "__upt" wide
		$a15 = "__msgid" wide

	condition:
		7 of ($a*)
}
