import "pe"

rule BINARYALERT_Malware_Windows_Moonlightmaze_U_Logcleaner : FILE
{
	meta:
		description = "Rule to detect log cleaners based on utclean.c"
		author = "Kaspersky Lab"
		id = "2dc1b796-c8fe-5a87-9d6b-3a322f4a43ab"
		date = "2017-08-11"
		modified = "2017-08-11"
		reference = "http://cd.textfiles.com/cuteskunk/Unix-Hacking-Exploits/utclean.c"
		source_url = "https://github.com/airbnb/binaryalert//blob/a9c0f06affc35e1f8e45bb77f835b92350c68a0b/rules/public/malware/windows/malware_windows_moonlightmaze_u_logcleaner.yara#L3-L18"
		license_url = "https://github.com/airbnb/binaryalert//blob/a9c0f06affc35e1f8e45bb77f835b92350c68a0b/LICENSE"
		logic_hash = "65fe29075294dfad06f4cca631d5d2f1283c439e9a5913f503fe6e4bb1f5f70a"
		score = 75
		quality = 80
		tags = "FILE"
		md5_1 = "d98796dcda1443a37b124dbdc041fe3b"
		md5_2 = "73a518f0a73ab77033121d4191172820"

	strings:
		$a1 = "Hiding complit...n"
		$a2 = "usage: %s <username> <fixthings> [hostname]"
		$a3 = "ls -la %s* ; /bin/cp  ./wtmp.tmp %s; rm  ./wtmp.tmp"

	condition:
		( uint32(0)==0x464c457f) and ( any of them )
}
